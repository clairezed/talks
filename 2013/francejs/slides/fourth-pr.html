<h2 id="Pull-Request-4"><a href="#Pull-Request-4" class="headerlink" title="Pull Request #4"></a>Pull Request #4</h2><p>Automatiser les fichiers de traduction.</p>
<p>@@@</p>
<pre><code class="javascript">grunt.registerTask(<span class="string">'generateJS'</span>, <span class="string">'Generate JS translation file for chosen language.'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">language</span>) </span>{
  <span class="function"><span class="keyword">function</span> <span class="title">normaliseInput</span>(<span class="params">string</span>)  </span>{
    <span class="keyword">var</span> length = string.length,
    i = <span class="number">0</span>,
    newString = <span class="string">""</span>;

    <span class="keyword">while</span> (i &lt; length) {
      <span class="keyword">if</span> (i === <span class="number">0</span>) {
        newString += string.charAt(i).toUpperCase();
      } <span class="keyword">else</span> {
        newString += string.charAt(i).toLowerCase()
      }

      i++
    }

    <span class="keyword">return</span> newString;
  }

  <span class="keyword">var</span> language = language || <span class="string">'English'</span>;
  language = normaliseInput(language);

  <span class="keyword">var</span> csv = grunt.file.read(<span class="string">'./webapp/static/js/module/translations/variables.csv'</span>);
  <span class="comment">// This will parse a delimited string into an array of</span>
  <span class="comment">// arrays. The default delimiter is the comma, but this</span>
  <span class="comment">// can be overriden in the second argument.</span>
  <span class="function"><span class="keyword">function</span> <span class="title">CSVToArray</span>(<span class="params"> strData, strDelimiter </span>)</span>{
    <span class="comment">// Check to see if the delimiter is defined. If not,</span>
    <span class="comment">// then default to comma.</span>
    strDelimiter = (strDelimiter || <span class="string">","</span>);

    <span class="comment">// Create a regular expression to parse the CSV values.</span>
    <span class="keyword">var</span> objPattern = <span class="keyword">new</span> <span class="built_in">RegExp</span>(
      (
        <span class="comment">// Delimiters.</span>
        <span class="string">"(\\"</span> + strDelimiter + <span class="string">"|\\r?\\n|\\r|^)"</span> +

        <span class="comment">// Quoted fields.</span>
        <span class="string">"(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|"</span> +

        <span class="comment">// Standard fields.</span>
        <span class="string">"([^\"\\"</span> + strDelimiter + <span class="string">"\\r\\n]*))"</span>
      ),
      <span class="string">"gi"</span>
      );


    <span class="comment">// Create an array to hold our data. Give the array</span>
    <span class="comment">// a default empty first row.</span>
    <span class="keyword">var</span> arrData = [[]];

    <span class="comment">// Create an array to hold our individual pattern</span>
    <span class="comment">// matching groups.</span>
    <span class="keyword">var</span> arrMatches = <span class="literal">null</span>;


    <span class="comment">// Keep looping over the regular expression matches</span>
    <span class="comment">// until we can no longer find a match.</span>
    <span class="keyword">while</span> (arrMatches = objPattern.exec( strData )){

      <span class="comment">// Get the delimiter that was found.</span>
      <span class="keyword">var</span> strMatchedDelimiter = arrMatches[ <span class="number">1</span> ];

      <span class="comment">// Check to see if the given delimiter has a length</span>
      <span class="comment">// (is not the start of string) and if it matches</span>
      <span class="comment">// field delimiter. If id does not, then we know</span>
      <span class="comment">// that this delimiter is a row delimiter.</span>
      <span class="keyword">if</span> (
        strMatchedDelimiter.length &amp;&amp;
        (strMatchedDelimiter != strDelimiter)
        ){

        <span class="comment">// Since we have reached a new row of data,</span>
        <span class="comment">// add an empty row to our data array.</span>
        arrData.push( [] );

      }


      <span class="comment">// Now that we have our delimiter out of the way,</span>
      <span class="comment">// let's check to see which kind of value we</span>
      <span class="comment">// captured (quoted or unquoted).</span>
      <span class="keyword">if</span> (arrMatches[ <span class="number">2</span> ]){

        <span class="comment">// We found a quoted value. When we capture</span>
        <span class="comment">// this value, unescape any double quotes.</span>
        <span class="keyword">var</span> strMatchedValue = arrMatches[ <span class="number">2</span> ].replace(
          <span class="keyword">new</span> <span class="built_in">RegExp</span>( <span class="string">"\"\""</span>, <span class="string">"g"</span> ),
          <span class="string">"\""</span>
          );

      } <span class="keyword">else</span> {

        <span class="comment">// We found a non-quoted value.</span>
        <span class="keyword">var</span> strMatchedValue = arrMatches[ <span class="number">3</span> ];

      }


      <span class="comment">// Now that we have our value string, let's add</span>
      <span class="comment">// it to the data array.</span>
      arrData[ arrData.length - <span class="number">1</span> ].push( strMatchedValue );
    }

    <span class="comment">// Return the parsed data.</span>
    <span class="keyword">return</span>( arrData );
  }

  <span class="keyword">var</span> array = CSVToArray(csv);

  <span class="keyword">var</span> propertyNames = array[<span class="number">0</span>];


  <span class="keyword">var</span> length = array.length, i = <span class="number">0</span>;
  <span class="keyword">var</span> languageWanted;

  <span class="comment">// locate the language wanted</span>
  <span class="keyword">for</span> (i ; i &lt; length; i++) {
    <span class="keyword">var</span> currentLanguage = array[i][<span class="number">1</span>];
    <span class="keyword">if</span> (currentLanguage == language) {
      languageWanted = array[i];
      <span class="keyword">break</span>;
    }
  }

  <span class="comment">//create the file needed for /define/'language'.js</span>
  <span class="keyword">var</span> languageString = <span class="string">'define({'</span>;
  <span class="keyword">var</span> fourSpaces = <span class="string">"    "</span>;
  length = propertyNames.length;
  <span class="comment">//make i = 2 to skip language.code and language.name being saved into the file</span>
  i = <span class="number">2</span>;
  <span class="keyword">for</span> (i ; i &lt; length; i++) {
    languageString += <span class="string">"\n"</span>;
    languageString += fourSpaces + propertyNames[i] + <span class="string">" : '"</span> + languageWanted[i] + <span class="string">"'"</span>;
    <span class="keyword">if</span> (i + <span class="number">1</span> !== length) {
        languageString += <span class="string">","</span>;
      } <span class="keyword">else</span> {
        languageString += <span class="string">"\n"</span>;
      }
  }

  languageString += <span class="string">"});"</span>;
  <span class="keyword">var</span> languageCode = languageWanted[<span class="number">0</span>];
  grunt.file.write(<span class="string">'./webapp/static/js/module/translations/'</span> + languageCode + <span class="string">'.js'</span>, languageString);
  grunt.file.delete(<span class="string">'./webapp/static/js/module/translations/variables.csv'</span>);
});
</code></pre>
<p>@@@</p>
<h2 id="Le-cas-typique"><a href="#Le-cas-typique" class="headerlink" title="Le cas typique"></a>Le cas typique</h2><p>Et le MVP idéal.</p>
<p>@@@</p>
<h2 id="Reinvente-la-roue"><a href="#Reinvente-la-roue" class="headerlink" title="Réinvente la roue"></a>Réinvente la roue</h2><p>Parsing CSV.</p>
<p>@@@</p>
<h2 id="Test-par-l’execution"><a href="#Test-par-l’execution" class="headerlink" title="Test par l’exécution"></a>Test par l’exécution</h2><p><code>assert(user.rant(&quot;ça marche pas&quot;))</code></p>
<p>@@@</p>
<h2 id="Manque-de-clarte-du-code"><a href="#Manque-de-clarte-du-code" class="headerlink" title="Manque de clarté du code"></a>Manque de clarté du code</h2><p>Lecture linéaire.</p>
<p>Code peu expressif quant à ses choix/opinions.</p>
<p>@@@</p>
<h2 id="Pourquoi"><a href="#Pourquoi" class="headerlink" title="Pourquoi ?"></a>Pourquoi ?</h2><p>Manque d’expérience / temps à consacrer.</p>
<p>Peu de littérature à ce sujet.</p>
<p>Mimétisme.</p>
